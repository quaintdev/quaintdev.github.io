<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Monitoring Solar Power Over WiFi | rohanrd.xyz</title>
<meta name="keywords" content="projects">
<meta name="description" content="Measuring solar panel output with Arduino and ESP8266 and viewing it on Grafana dashboard with InfluxDB hosted on Raspberry PI">
<meta name="author" content="Rohan D">
<link rel="canonical" href="https://rohanrd.xyz/posts/monitoring-solar-power-over-wifi/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://rohanrd.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://rohanrd.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://rohanrd.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://rohanrd.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://rohanrd.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Monitoring Solar Power Over WiFi" />
<meta property="og:description" content="Measuring solar panel output with Arduino and ESP8266 and viewing it on Grafana dashboard with InfluxDB hosted on Raspberry PI" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rohanrd.xyz/posts/monitoring-solar-power-over-wifi/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-20T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Monitoring Solar Power Over WiFi"/>
<meta name="twitter:description" content="Measuring solar panel output with Arduino and ESP8266 and viewing it on Grafana dashboard with InfluxDB hosted on Raspberry PI"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://rohanrd.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Monitoring Solar Power Over WiFi",
      "item": "https://rohanrd.xyz/posts/monitoring-solar-power-over-wifi/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Monitoring Solar Power Over WiFi",
  "name": "Monitoring Solar Power Over WiFi",
  "description": "Measuring solar panel output with Arduino and ESP8266 and viewing it on Grafana dashboard with InfluxDB hosted on Raspberry PI",
  "keywords": [
    "projects"
  ],
  "articleBody": " India is rapidly switching to renewable energy sources. Itâ€™s not just the government thatâ€™s making the switch but people as well have been switching to solar roof tops for their power requirements. In our society, 30-40% houses have set up solar panels on their roofs. Most of these houses do not pay at all to the MSEB but on the other hand contribute surplus to the grid.\nThe one that is setup at my home - shown in picture above - has 2.27 kWh capacity. Over the past 3-4 months I have been monitoring the output of these panels and they have been on average producing 220-270 kW per month. There is around 70-100 units of surplus which is fed into the grid every month. I have seen output of about maximum 11.6 kWh in a single day. Rest of days it fluctuates in 6-8 kWh range. There are many parameters affecting output like weather, panel temperature, dust on the panels. I do not have any control over the weather but rest two parameters can be kept in check to improve efficiency of these panels.\nCurrently, only way to monitor output of these panels is by checking the inverter manually. This is not helpful at all. Moreover I would prefer to have this data recorded on per minute basis rather than looking at aggregates at the end of the day. I need a system that will continuously log the panel output to a central database. Logging to central database has its own advantages: I can not only do a thorough analysis but also get power stats over the Internet. Letâ€™s build this ðŸ˜ƒ\nComponents SCT-013-030: A non-invasive current sensor with a clip-on. I did not wanted to meddle with 230V mains supply, hence this sensor. You can clip it on any wire and it will generate output voltage corresponding to the current flowing from the wire. Arduino Uno: I had this sitting in my closet. It has an ADC onboard which can be used to measure output of the current sensor. ESP01 WiFi module: This module can directly transmit data over WiFi network and it was the cheapest one that I found. Also, it seems it can be easily interfaced with Arduino. 3.3V power supply: ESP01 needs a regulated 3.3v power supply A raspberry pi: This is used for capturing the data shared by ESP01 and as a data logger. Eventually this will also be used as a server to broadcast captured data over Internet. A Note on ESP01 I am using Micropython firmware for ESP01. Stock AT firmware should also work. I chose Micropython because I was facing issues communicating with Arduino over serial. Although I later found out that the issue was because of power supply. ESP01 strictly needs 3.3V[1]. The issue went away once it was powered by a dedicated 3.3V power supply instead of Arduinoâ€™s 3.3V supply. I spent lot of time resolving this issue. ðŸ˜…\nInterfacing Arduino With ESP01 The interfacing here is for serial communication between Arduino and ESP01. If you want to flash or load programs on ESP01 using Arduino you will have to change wiring. Refer this note for wiring, flashing and loading programs on ESP01.\nBelow is the wiring between UNO and ESP01 for serial communication. You can choose different pins for RX \u0026 TX in your code.\nUNO â€” ESP8266 RX â€” 11 TX â€” 10 GND â€” GND 3.3V â€” VCC 3.3V â€” CH_PD The configuration of Arduino environment is out of scope of this article. Arduino IDE makes it very easy to load programs on Arduino.\nSerial I/O and Broadcast Serial write with Arduino\nHereâ€™s listing of code that writes Hello from Arduino to ESP01\n#include #define RX 10 #define TX 11 SoftwareSerial esp8266(RX, TX); void setup() { esp8266.begin(115200); } void loop() { esp8266.println(\"Hello from Arduino\"); delay(3000); } Serial read from ESP01\nESP SoC has 2 serial I/Os. UART 1 is write only and UART 0 can do perform both read and write. That is why we have to use UART0 for communication with Arduino. But thereâ€™s a catch with UART0, it is used by micropython REPL for loading programs. The only way to communicate with Arduino over serial is to detach UART0 from REPL. Doing this would disable the functionality to load or edit programs until it is re-attached[2].\nuos.dupterm(None, 1) # detach UART from REPL. uart = UART(0, 115200) # UART 0 is available for our program if uart.any(): message = uart.readline() # read data from serial input uos.dupterm(uart, 1) # re-attach UART with REPL before end of program Broadcast over WiFi\nNow that the data is read from serial itâ€™s time to broadcast it over WiFi using below function\ndef broadcast(message: bytes): cs = socket(AF_INET, SOCK_DGRAM) cs.sendto(message, ('192.168.0.255', 7007)) The socket is a UDP socket as selected by SOCK_DGRAM parameter. We are choosing to send the message over broadcast address 192.168.0.255 so that we can receive it on any device on network. Listening to the message on a Linux system is as easy as running the command\n# listen continuosly for messages on udp socket port 7007 nc -kul 7007 I would recommend that you run the serial read and broadcast operation on your ESP01 before you load the actual program to confirm everything is working properly.\nMeasuring Current We can measure AC output voltage of CT sensor using ADC on Arduino. The signal first needs to be shifted above 0V in order to meet requirements of ADC. We use a voltage divider circuit as shown below to shift the analog signal by 2.5V so that its lower peak always stays above 0V. Note that our CT sensor has output of 0-1V.\nWe will be using EmonLib from Open Energy Monitor to sample and measure the RMS current. Hereâ€™s a code listing to read current from A0 pin with EmonLib.\nEnergyMonitor emon1; void setup() { Serial.begin(9600); emon1.current(1, 30); //specify pin and calibration } void loop() { double I = emon1.calcIrms(1480); //number of samples to take Serial.println(\"cu value=\" + String(I));\t//write data to esp in a InfluxDB line format delay(3000); } emon1.current(1,30) is used to choose ADC pin and for calibration. For the sensor I am using, it is 30. You can find out more about calibration calculation here.\nData Logging And Dashboarding For logging we are going to use timeseries database InfluxDB. InfluxDB integrates well with Grafana which we will be using for dashboarding. Both InfluxDB and Grafana will be installed on Raspberry Pi. Installation of both application is pretty straightforward. You can refer the guides included in notes below[3].\nIngesting Data With InfluxDB Line Protocol The fastest way of inserting a record in InfluxDB is through itâ€™s CLI. Hereâ€™s an example:\n$ influxdb \u003e CREATE pmon \u003e USE pmon \u003e cu value=2.2 \u003e cu value=2.5 First we create database pmon and then insert values 2.2 and 2.5 as current(cu) in it. You can see inserted records along with timestamps using show measurements command. InfluxDB supports a lot of interfaces REST, UDP, etc,. Since we have already implemented the broadcast over UDP with ESP01 we will be using UDP interface of InfluxDB but first we need to enable UDP interface before we can start ingesting data over it. You can enable the interface in influxdb.conf. This file on exist at /etc/influxdb/influxdb.conf on raspbian. In the udp section add\n[[udp]] enabled = true bind-address = \"0.0.0.0:7007\"\t# port address to listen on database = \"pmon\" retention-policy = \"\" batch-size = 2\t# write to database after collecting this many measurements There are more options in the config file which you can explore as per your requirement.\nDashboard with Grafana Integrating Grafana with InfluxDB is pretty easy. Grafana can be accessed from browser for its configuration. Just point your browser to your Pi IP with 3000 port and that should open Grafana. You will have to go through some basic configuration steps and then from the settings panel you can add InfluxDB as data source. Thatâ€™s it. You can start creating panels for the data that has been recorded.\nHereâ€™s Grafana dashboard for my home setup\nCreating Grafana Panels InfluxDB queries are fairly easy to understand so I will just put the queries behind each panel that I have used\nCurrent Panel\nSELECT value FROM \"cu\" Power Panel\nSELECT value*252 FROM \"cu\"\nThe voltage at my home averages around 252V. Since, P=VxI. Power generated = 252*value. Energy Generated Hourly in Wh panel\nSELECT integral(\"power\")/3600 FROM (SELECT value*252 AS power FROM \"cu\") WHERE $timeFilter GROUP BY time(1h) fill(null)\nEnergy generated is the area under the power curve. Hence, the integral. We are calculating energy generated on per hour basis. Todayâ€™s generation panel\nSELECT integral(\"value\")*252/3600000 FROM (SELECT value FROM \"cu\") where time \u003e now()-12h\nSame as energy generated calculation but here we do for last 12 hours. Monthly energy generated panel\nSame as todayâ€™s generation panel but calculated over period of 30d Carbon panels\nCarbon generated per kWh is called as carbon factor for the grid. For India, it is 0.7 and thus Energy(E)*0.7 gives us the carbon removed from atmosphere. Final Words I am very happy with this setup and itâ€™s been very reliable so far even though I have done all of this on a bread board! The current readings are pretty accurate above 1A. There is deviation in power and energy measurements but this is because we are assuming constant voltage while in reality it fluctuates quite a bit. Maybe I will add voltage sensor to this!\nRepository Both micropython and arduino code is uploaded at https://github.com/quaintdev/EnergyMonitor\nNotes:\nThere are instances when people have ran ESP01 chip on 5V. This is most probably because of how different manufactures design their chips. The ESP8266 SoC on board ESP01 needs 3.3V. Our program is expected to communicate with Arduino continously and that is why we cannot re-attach the REPL. In the final code listing I have added delay of 10 seconds before detatching REPL. This gives us enough time to load new programs on ESP if required. If we do not do this then we loose the ability to load programs on ESP until we re-flash the firmware. Install grafana on Raspberry PI\nInstall influxdb on Raspberry PI CT sensor interfacing with Arduino ",
  "wordCount" : "1706",
  "inLanguage": "en",
  "datePublished": "2021-01-20T00:00:00Z",
  "dateModified": "2021-01-20T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Rohan D"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://rohanrd.xyz/posts/monitoring-solar-power-over-wifi/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "rohanrd.xyz",
    "logo": {
      "@type": "ImageObject",
      "url": "https://rohanrd.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://rohanrd.xyz" accesskey="h" title="rohanrd.xyz (Alt + H)">rohanrd.xyz</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://rohanrd.xyz/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://rohanrd.xyz/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://rohanrd.xyz/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://rohanrd.xyz">Home</a>&nbsp;Â»&nbsp;<a href="https://rohanrd.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Monitoring Solar Power Over WiFi
    </h1>
    <div class="post-meta"><span title='2021-01-20 00:00:00 +0000 UTC'>January 20, 2021</span>&nbsp;Â·&nbsp;9 min&nbsp;Â·&nbsp;Rohan D

</div>
  </header> 
  <div class="post-content"><p><img loading="lazy" src="/static/solar_panel.jpg" alt="solar panel"  />
</p>
<p>India is rapidly switching to renewable energy sources. It&rsquo;s not just the government that&rsquo;s making the switch but people as well have been switching to solar roof tops for their power requirements. In our society, 30-40% houses have set up solar panels on their roofs. Most of these houses do not pay at all to the MSEB but on the other hand contribute surplus to the grid.</p>
<p>The one that is setup at my home - shown in picture above - has 2.27 kWh capacity. Over the past 3-4 months I have been monitoring the output of these panels and they have been on average producing 220-270 kW per month. There is around 70-100 units of surplus which is fed into the grid every month. I have seen output of about maximum 11.6 kWh in a single day. Rest of days it fluctuates in 6-8 kWh range. There are many parameters affecting output like weather, panel temperature, dust on the panels. I do not have any control over the weather but rest two parameters can be kept in check to improve efficiency of these panels.</p>
<p>Currently, only way to monitor output of these panels is by checking the inverter manually. This is not helpful at all. Moreover I would prefer to have this data recorded on per minute basis rather than looking at aggregates at the end of the day. I need a system that will continuously log the panel output to a central database. Logging to central database has its own advantages: I can not only do a thorough analysis but also get power stats over the Internet. Let&rsquo;s build this ðŸ˜ƒ</p>
<h3 id="components">Components<a hidden class="anchor" aria-hidden="true" href="#components">#</a></h3>
<p><img loading="lazy" src="/static/sct_resize.jpg" alt="floatright"  title="The sensor must be clipped on phase"  />
</p>
<ol>
<li>SCT-013-030: A non-invasive current sensor with a clip-on. I did not wanted to meddle with 230V mains supply, hence this sensor. You can clip it on any wire and it will generate output voltage corresponding to the current flowing from the wire.</li>
<li>Arduino Uno: I had this sitting in my closet. It has an ADC onboard which can be used to measure output of the current sensor.</li>
<li>ESP01 WiFi module: This module can directly transmit data over WiFi network and it was the cheapest one that I found. Also, it seems it can be easily interfaced with Arduino.</li>
<li>3.3V power supply: ESP01 needs a regulated 3.3v power supply</li>
<li>A raspberry pi: This is used for capturing the data shared by ESP01 and as a data logger. Eventually this will also be used as a server to broadcast captured data over Internet.</li>
</ol>
<h3 id="a-note-on-esp01">A Note on ESP01<a hidden class="anchor" aria-hidden="true" href="#a-note-on-esp01">#</a></h3>
<p>I am using Micropython firmware for ESP01. Stock AT firmware should also work. I chose Micropython because I was facing issues communicating with Arduino over serial. Although I later found out that the issue was because of power supply. ESP01 strictly needs 3.3V[1]. The issue went away once it was powered by a dedicated 3.3V power supply instead of Arduino&rsquo;s 3.3V supply. I spent lot of time resolving this issue. ðŸ˜…</p>
<h3 id="interfacing-arduino-with-esp01">Interfacing Arduino With ESP01<a hidden class="anchor" aria-hidden="true" href="#interfacing-arduino-with-esp01">#</a></h3>
<p>The interfacing here is for serial communication between Arduino and ESP01. If you want to flash or load programs on ESP01 using Arduino you will have to change wiring. Refer this <a href="https://www.ankshilp.com/flashing_esp_with_arduino/">note</a> for wiring, flashing and loading programs on ESP01.</p>
<p>Below is the wiring between UNO and ESP01 for serial communication. You can choose different pins for RX &amp; TX in your code.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>    UNO â€” ESP8266
</span></span><span style="display:flex;"><span>    RX â€” 11 
</span></span><span style="display:flex;"><span>    TX â€” 10 
</span></span><span style="display:flex;"><span>    GND â€” GND 
</span></span><span style="display:flex;"><span>    3.3V â€” VCC 
</span></span><span style="display:flex;"><span>    3.3V â€” CH_PD
</span></span></code></pre></div><p>The configuration of Arduino environment is out of scope of this article. Arduino IDE makes it very easy to load programs on Arduino.</p>
<h3 id="serial-io-and-broadcast">Serial I/O and Broadcast<a hidden class="anchor" aria-hidden="true" href="#serial-io-and-broadcast">#</a></h3>
<p><strong>Serial write with Arduino</strong><br>
Here&rsquo;s listing of code that writes <code>Hello from Arduino</code> to ESP01</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#080">#include</span> <span style="color:#080">&lt;SoftwareSerial.h&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080">#define RX 10
</span></span></span><span style="display:flex;"><span><span style="color:#080">#define TX 11
</span></span></span><span style="display:flex;"><span><span style="color:#080"></span>SoftwareSerial <span style="color:#00a000">esp8266</span>(RX, TX);
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">setup</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    esp8266.begin(<span style="color:#666">115200</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">loop</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    esp8266.println(<span style="color:#b44">&#34;Hello from Arduino&#34;</span>);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#666">3000</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Serial read from ESP01</strong><br>
ESP SoC has 2 serial I/Os. UART 1 is write only and UART 0 can do perform both read and write. That is why we have to use UART0 for communication with Arduino. But there&rsquo;s a catch with UART0, it is used by micropython REPL for loading programs. The only way to communicate with Arduino over serial is to detach UART0 from REPL. Doing this would disable the functionality to load or edit programs until it is re-attached[2].</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>uos<span style="color:#666">.</span>dupterm(<span style="color:#a2f;font-weight:bold">None</span>, <span style="color:#666">1</span>)            <span style="color:#080;font-style:italic"># detach UART from REPL. </span>
</span></span><span style="display:flex;"><span>uart <span style="color:#666">=</span> UART(<span style="color:#666">0</span>, <span style="color:#666">115200</span>)          <span style="color:#080;font-style:italic"># UART 0 is available for our program</span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">if</span> uart<span style="color:#666">.</span>any():
</span></span><span style="display:flex;"><span>    message <span style="color:#666">=</span> uart<span style="color:#666">.</span>readline()   <span style="color:#080;font-style:italic"># read data from serial input</span>
</span></span><span style="display:flex;"><span>uos<span style="color:#666">.</span>dupterm(uart, <span style="color:#666">1</span>)            <span style="color:#080;font-style:italic"># re-attach UART with REPL before end of program</span>
</span></span></code></pre></div><p><strong>Broadcast over WiFi</strong><br>
Now that the data is read from serial it&rsquo;s time to broadcast it over WiFi using below function</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">broadcast</span>(message: <span style="color:#a2f">bytes</span>):
</span></span><span style="display:flex;"><span>    cs <span style="color:#666">=</span> socket(AF_INET, SOCK_DGRAM)
</span></span><span style="display:flex;"><span>    cs<span style="color:#666">.</span>sendto(message, (<span style="color:#b44">&#39;192.168.0.255&#39;</span>, <span style="color:#666">7007</span>))
</span></span></code></pre></div><p>The socket is a UDP socket as selected by <code>SOCK_DGRAM</code> parameter. We are choosing to send the message over broadcast address <code>192.168.0.255</code> so that we can receive it on any device on network. Listening to the message on a Linux system is as easy as running the command</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#080;font-style:italic"># listen continuosly for messages on udp socket port 7007</span>
</span></span><span style="display:flex;"><span>nc -kul <span style="color:#666">7007</span>
</span></span></code></pre></div><p>I would recommend that you run the serial read and broadcast operation on your ESP01 before you load the actual program to confirm everything is working properly.</p>
<h3 id="measuring-current">Measuring Current<a hidden class="anchor" aria-hidden="true" href="#measuring-current">#</a></h3>
<p>We can measure AC output voltage of CT sensor using ADC on Arduino. The signal first needs to be shifted above 0V in order to meet requirements of ADC. We use a voltage divider circuit as shown below to shift the analog signal by 2.5V so that its lower peak always stays above 0V. Note that our CT sensor has  output of 0-1V.</p>
<p><img loading="lazy" src="/static/circuit.png" alt=""  />
</p>
<p>We will be using <a href="https://github.com/openenergymonitor/EmonLib">EmonLib</a> from <a href="https://openenergymonitor.org/">Open Energy Monitor</a> to sample and measure the RMS current. Here&rsquo;s a code listing to read current from A0 pin with EmonLib.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>EnergyMonitor emon1;
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">setup</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  Serial.begin(<span style="color:#666">9600</span>);
</span></span><span style="display:flex;"><span>  emon1.current(<span style="color:#666">1</span>, <span style="color:#666">30</span>); <span style="color:#080;font-style:italic">//specify pin and calibration
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>}
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">loop</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#0b0;font-weight:bold">double</span> I <span style="color:#666">=</span> emon1.calcIrms(<span style="color:#666">1480</span>); 		<span style="color:#080;font-style:italic">//number of samples to take 
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>  Serial.println(<span style="color:#b44">&#34;cu value=&#34;</span> <span style="color:#666">+</span> String(I));	<span style="color:#080;font-style:italic">//write data to esp in a InfluxDB line format
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>  delay(<span style="color:#666">3000</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>emon1.current(1,30)</code> is used to choose ADC pin and for calibration. For the sensor I am using, it is 30. You can find out more about calibration calculation <a href="https://github.com/openenergymonitor/learn/blob/master/view/electricity-monitoring/ctac/emonlib-calibration-theory.md">here</a>.</p>
<h3 id="data-logging-and-dashboarding">Data Logging And Dashboarding<a hidden class="anchor" aria-hidden="true" href="#data-logging-and-dashboarding">#</a></h3>
<p>For logging we are going to use timeseries database InfluxDB. InfluxDB integrates well with Grafana which we will be using for dashboarding. Both InfluxDB and Grafana will be installed on Raspberry Pi. Installation of both application is pretty straightforward. You can refer the guides included in notes below[3].</p>
<h4 id="ingesting-data-with-influxdb-line-protocol">Ingesting Data With InfluxDB Line Protocol<a hidden class="anchor" aria-hidden="true" href="#ingesting-data-with-influxdb-line-protocol">#</a></h4>
<p>The fastest way of inserting a record in InfluxDB is through it&rsquo;s CLI. Here&rsquo;s an example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ influxdb
</span></span><span style="display:flex;"><span>&gt; CREATE pmon
</span></span><span style="display:flex;"><span>&gt; USE pmon
</span></span><span style="display:flex;"><span>&gt; cu value=2.2
</span></span><span style="display:flex;"><span>&gt; cu value=2.5
</span></span></code></pre></div><p>First we create database pmon and then insert values 2.2 and 2.5 as current(cu) in it. You can see inserted records along with timestamps using <code>show measurements</code> command. InfluxDB supports a lot of interfaces REST, UDP, etc,. Since we have already implemented the broadcast over UDP with ESP01 we will be using UDP interface of InfluxDB but first we need to enable UDP interface before we can start ingesting data over it. You can enable the interface in <code>influxdb.conf</code>. This file on  exist at <code>/etc/influxdb/influxdb.conf</code> on raspbian. In the udp section add</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#666">[[</span>udp<span style="color:#666">]]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b8860b">enabled</span> <span style="color:#666">=</span> <span style="color:#a2f">true</span>
</span></span><span style="display:flex;"><span>  bind-address <span style="color:#666">=</span> <span style="color:#b44">&#34;0.0.0.0:7007&#34;</span>		<span style="color:#080;font-style:italic"># port address to listen on</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b8860b">database</span> <span style="color:#666">=</span> <span style="color:#b44">&#34;pmon&#34;</span>
</span></span><span style="display:flex;"><span>  retention-policy <span style="color:#666">=</span> <span style="color:#b44">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  batch-size <span style="color:#666">=</span> 2						<span style="color:#080;font-style:italic"># write to database after collecting this many measurements</span>
</span></span></code></pre></div><p>There are more options in the config file which you can explore as per your requirement.</p>
<h4 id="dashboard-with-grafana">Dashboard with Grafana<a hidden class="anchor" aria-hidden="true" href="#dashboard-with-grafana">#</a></h4>
<p>Integrating Grafana with InfluxDB is pretty easy. Grafana can be accessed from browser for its configuration. Just point your browser to your Pi IP with 3000 port and that should open Grafana. You will have to go through some basic configuration steps and then from the settings panel you can add InfluxDB as data source. That&rsquo;s it. You can start creating panels for the data that has been recorded.</p>
<p>Here&rsquo;s Grafana dashboard for my home setup</p>
<p><img loading="lazy" src="/static/solar.png" alt=""  />
</p>
<h4 id="creating-grafana-panels">Creating Grafana Panels<a hidden class="anchor" aria-hidden="true" href="#creating-grafana-panels">#</a></h4>
<p>InfluxDB queries are fairly easy to understand so I will just put the queries behind each panel that I have used</p>
<ol>
<li>Current Panel<br>
<code>SELECT value FROM &quot;cu&quot;</code></li>
<li>Power Panel<br>
<code>SELECT value*252 FROM &quot;cu&quot;</code><br>
The voltage at my home averages around 252V. Since, P=VxI. Power generated = 252*value.</li>
<li>Energy Generated Hourly in Wh panel<br>
<code>SELECT integral(&quot;power&quot;)/3600 FROM (SELECT value*252 AS power FROM &quot;cu&quot;) WHERE $timeFilter GROUP BY time(1h) fill(null)</code><br>
Energy generated is the area under the power curve. Hence, the integral. We are calculating energy generated on per hour basis.</li>
<li>Today&rsquo;s generation panel<br>
<code>SELECT integral(&quot;value&quot;)*252/3600000 FROM (SELECT value FROM &quot;cu&quot;)  where time &gt; now()-12h</code><br>
Same as energy generated calculation but here we do for last 12 hours.</li>
<li>Monthly energy generated panel<br>
Same as today&rsquo;s generation panel but calculated over period of <code>30d</code></li>
<li>Carbon panels<br>
Carbon generated per kWh is called as carbon factor for the grid. For India, it is 0.7 and thus <code>Energy(E)*0.7</code> gives us the carbon removed from atmosphere.</li>
</ol>
<h3 id="final-words">Final Words<a hidden class="anchor" aria-hidden="true" href="#final-words">#</a></h3>
<p>I am very happy with this setup and it&rsquo;s been very reliable so far even though I have done all of this on a bread board! The current readings are pretty accurate above 1A. There is deviation in power and energy measurements but this is because we are assuming constant voltage while in reality it fluctuates quite a bit. Maybe I will add voltage sensor to this!</p>
<h3 id="repository">Repository<a hidden class="anchor" aria-hidden="true" href="#repository">#</a></h3>
<p>Both micropython and arduino code is uploaded at <a href="https://github.com/quaintdev/EnergyMonitor">https://github.com/quaintdev/EnergyMonitor</a></p>
<p>Notes:</p>
<ol>
<li>There are instances when people have ran ESP01 chip on 5V. This is most probably because of how different manufactures design their chips. The ESP8266 SoC on board ESP01 needs 3.3V.</li>
<li>Our program is expected to communicate with Arduino continously and that is why we cannot re-attach the REPL. In the final code listing I have added delay of 10 seconds before detatching REPL. This gives us enough time to load new programs on ESP if required. If we do not do this then we loose the ability to load programs on ESP until we re-flash the firmware.</li>
<li><a href="https://grafana.com/tutorials/install-grafana-on-raspberry-pi/">Install grafana on Raspberry PI</a><br>
<a href="https://gist.github.com/boseji/bb71910d43283a1b84ab200bcce43c26">Install influxdb on Raspberry PI</a></li>
<li><a href="https://learn.openenergymonitor.org/electricity-monitoring/ct-sensors/interface-with-arduino">CT sensor interfacing with Arduino</a></li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://rohanrd.xyz/tags/projects/">projects</a></li>
    </ul>

<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Monitoring Solar Power Over WiFi on x"
            href="https://x.com/intent/tweet/?text=Monitoring%20Solar%20Power%20Over%20WiFi&amp;url=https%3a%2f%2frohanrd.xyz%2fposts%2fmonitoring-solar-power-over-wifi%2f&amp;hashtags=projects">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Monitoring Solar Power Over WiFi on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frohanrd.xyz%2fposts%2fmonitoring-solar-power-over-wifi%2f&amp;title=Monitoring%20Solar%20Power%20Over%20WiFi&amp;summary=Monitoring%20Solar%20Power%20Over%20WiFi&amp;source=https%3a%2f%2frohanrd.xyz%2fposts%2fmonitoring-solar-power-over-wifi%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Monitoring Solar Power Over WiFi on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2frohanrd.xyz%2fposts%2fmonitoring-solar-power-over-wifi%2f&title=Monitoring%20Solar%20Power%20Over%20WiFi">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Monitoring Solar Power Over WiFi on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frohanrd.xyz%2fposts%2fmonitoring-solar-power-over-wifi%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Monitoring Solar Power Over WiFi on whatsapp"
            href="https://api.whatsapp.com/send?text=Monitoring%20Solar%20Power%20Over%20WiFi%20-%20https%3a%2f%2frohanrd.xyz%2fposts%2fmonitoring-solar-power-over-wifi%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Monitoring Solar Power Over WiFi on telegram"
            href="https://telegram.me/share/url?text=Monitoring%20Solar%20Power%20Over%20WiFi&amp;url=https%3a%2f%2frohanrd.xyz%2fposts%2fmonitoring-solar-power-over-wifi%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Monitoring Solar Power Over WiFi on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Monitoring%20Solar%20Power%20Over%20WiFi&u=https%3a%2f%2frohanrd.xyz%2fposts%2fmonitoring-solar-power-over-wifi%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://rohanrd.xyz">rohanrd.xyz</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
